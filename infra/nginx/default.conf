server {
  listen 80;

  # PHP App at /
  location / {
    proxy_pass         http://web:80;
    proxy_set_header   Host              $host;
    proxy_set_header   X-Real-IP         $remote_addr;
    proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
    proxy_redirect     off;
  }

  # phpMyAdmin at /pma/
  location /pma/ {
    proxy_pass         http://phpmyadmin:80/;
    proxy_set_header   Host              $host;
    proxy_set_header   X-Real-IP         $remote_addr;
    proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
    proxy_redirect     off;

    # กัน 404 จากเส้นทางย่อย
    sub_filter_once off;
    sub_filter 'href="/' 'href="/pma/';
    sub_filter 'src="/'  'src="/pma/';
  }

  # เพิ่มความปลอดภัยเบื้องต้น (ปรับเพิ่มได้)
  add_header X-Frame-Options "SAMEORIGIN";
  add_header X-Content-Type-Options "nosniff";
  add_header Referrer-Policy "strict-origin-when-cross-origin";
}
